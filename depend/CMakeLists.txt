
ADD_CUSTOM_TARGET(depend)

### glm
MESSAGE("Adding dependency: glm")

SET(GLM_INCLUDE_DIRS "${CMAKE_CURRENT_LIST_DIR}/glm" PARENT_SCOPE)

ADD_CUSTOM_TARGET(glm)
ADD_DEPENDENCIES(depend glm)

### nlohmann_json
MESSAGE("Adding dependency: json")

SET(JSON_INCLUDE_DIRS "${CMAKE_CURRENT_LIST_DIR}/json/src" PARENT_SCOPE)

ADD_CUSTOM_TARGET(json)
ADD_DEPENDENCIES(depend json)

### lua
MESSAGE("Adding dependency: lua")

SET(LUA_OPTIONS
)

SET(LUA_INCLUDE_DIRS
    "${CMAKE_CURRENT_SOURCE_DIR}/lua/src"
    "${CMAKE_BINARY_DIR}/depend/lua"
    PARENT_SCOPE
)

IF(MSVC)
    SET(LUA_LIBRARIES_DEBUG
        "${CMAKE_BINARY_DIR}/depend/lua/Debug/lua.lib"
        PARENT_SCOPE
    )
    SET(LUA_LIBRARIES_RELEASE
        "${CMAKE_BINARY_DIR}/depend/lua/Release/lua.lib"
        PARENT_SCOPE
    )
ELSE()
    SET(LUA_LIBRARIES "${CMAKE_BINARY_DIR}/depend/lua/liblua.so" PARENT_SCOPE)
ENDIF()

FILE(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/depend/lua)
EXECUTE_PROCESS(
    COMMAND ${CMAKE_COMMAND} -G "${CMAKE_GENERATOR}"
        ${CMAKE_CURRENT_SOURCE_DIR}/lua ${LUA_OPTIONS}
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/lua
)

ADD_CUSTOM_TARGET(lua)
ADD_CUSTOM_COMMAND(
    TARGET lua PRE_BUILD
    COMMAND ${CMAKE_COMMAND} --build . --target liblua
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/lua
)
ADD_DEPENDENCIES(depend lua)

### zlib
MESSAGE("Adding dependency: zlib")

SET(ZLIB_OPTIONS
)

SET(ZLIB_INCLUDE_DIRS
    "${CMAKE_CURRENT_SOURCE_DIR}/zlib"
    "${CMAKE_BINARY_DIR}/depend/zlib"
    PARENT_SCOPE
)

IF(MSVC)
    SET(ZLIB_LIBRARIES_DEBUG
        "${CMAKE_BINARY_DIR}/depend/zlib/Debug/zlibd.lib"
        PARENT_SCOPE
    )
    SET(ZLIB_LIBRARIES_RELEASE
        "${CMAKE_BINARY_DIR}/depend/zlib/Release/zlibd.lib"
        PARENT_SCOPE
    )
ELSE()
    SET(ZLIB_LIBRARIES "${CMAKE_BINARY_DIR}/depend/zlib/libz.so" PARENT_SCOPE)
ENDIF()

FILE(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/depend/zlib)
EXECUTE_PROCESS(
    COMMAND ${CMAKE_COMMAND} -G "${CMAKE_GENERATOR}"
        ${CMAKE_CURRENT_SOURCE_DIR}/zlib ${ZLIB_OPTIONS}
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/zlib
)

ADD_CUSTOM_TARGET(zlib)
ADD_CUSTOM_COMMAND(
    TARGET zlib PRE_BUILD
    COMMAND ${CMAKE_COMMAND} --build . --target zlib
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/zlib
)
ADD_DEPENDENCIES(depend zlib)

### GLFW
MESSAGE("Adding dependency: glfw")

SET(GLFW_OPTIONS
    -DGLFW_BUILD_EXAMPLES=OFF
    -DGLFW_BUILD_TESTS=OFF
    -DGLFW_BUILD_DOCS=OFF
    -DGLFW_INSTALL=OFF
)

SET(GLFW_INCLUDE_DIRS
    "${CMAKE_CURRENT_SOURCE_DIR}/glfw/include"
    PARENT_SCOPE
)

IF(MSVC)
    SET(GLFW_LIBRARIES_DEBUG
        "${CMAKE_BINARY_DIR}/depend/glfw/src/Debug/glfw3.lib"
        PARENT_SCOPE
    )
    SET(GLFW_LIBRARIES_RELEASE
        "${CMAKE_BINARY_DIR}/depend/glfw/src/Release/glfw3.lib"
        PARENT_SCOPE
    )
ELSE()
    SET(GLFW_OPTIONS ${GLFW_OPTIONS} -DBUILD_SHARED_LIBS=ON)
    SET(GLFW_LIBRARIES
        "${CMAKE_BINARY_DIR}/depend/glfw/src/libglfw.so"
        PARENT_SCOPE
    )
ENDIF()

FILE(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/depend/glfw)
EXECUTE_PROCESS(
    COMMAND ${CMAKE_COMMAND} -G "${CMAKE_GENERATOR}"
        ${CMAKE_CURRENT_SOURCE_DIR}/glfw ${GLFW_OPTIONS}
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/glfw
)

ADD_CUSTOM_TARGET(glfw)
ADD_CUSTOM_COMMAND(
    TARGET glfw PRE_BUILD
    COMMAND ${CMAKE_COMMAND} --build . --target glfw
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/glfw
)
ADD_DEPENDENCIES(depend glfw)

### FlatBuffers
MESSAGE("Adding dependency: flatbuffers")

SET(FLATBUFFERS_OPTIONS
    -DFLATBUFFERS_BUILD_TESTS=OFF
    -DFLATBUFFERS_BUILD_FLATHASH=OFF
    -DFLATBUFFERS_INSTALL=OFF
)

SET(FLATBUFFERS_INCLUDE_DIRS
    "${CMAKE_CURRENT_SOURCE_DIR}/flatbuffers/include"
    PARENT_SCOPE
)

IF(MSVC)
    SET(FLATBUFFERS_LIBRARIES_DEBUG
        "${CMAKE_BINARY_DIR}/depend/flatbuffers/Debug/flatbuffers.lib"
        PARENT_SCOPE
    )
    SET(FLATBUFFERS_LIBRARIES_RELEASE
        "${CMAKE_BINARY_DIR}/depend/flatbuffers/Release/flatbuffers.lib"
        PARENT_SCOPE
    )
ELSE()
    SET(FLATBUFFERS_LIBRARIES "${CMAKE_BINARY_DIR}/depend/flatbuffers/libflatbuffers.a" PARENT_SCOPE)
ENDIF()

FILE(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/depend/flatbuffers)
EXECUTE_PROCESS(
    COMMAND ${CMAKE_COMMAND} -G "${CMAKE_GENERATOR}"
        ${CMAKE_CURRENT_SOURCE_DIR}/flatbuffers ${ZLIB_OPTIONS}
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/flatbuffers
)

ADD_CUSTOM_TARGET(flatbuffers)
ADD_CUSTOM_COMMAND(
    TARGET flatbuffers PRE_BUILD
    COMMAND ${CMAKE_COMMAND} --build . --target flatbuffers
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/depend/flatbuffers
)
ADD_DEPENDENCIES(depend flatbuffers)

SET_TARGET_PROPERTIES(
    depend glm json lua zlib glfw flatbuffers
    PROPERTIES FOLDER "depend"
)
